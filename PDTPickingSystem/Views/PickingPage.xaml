<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="PDTPickingSystem.Views.PickingPage"
             Title="Picking Page"
             BackgroundColor="White">

    <ScrollView>
        <VerticalStackLayout Padding="10" Spacing="10">

            <!-- Activity Indicator for server request -->
            <ActivityIndicator x:Name="pbReq"
                  IsRunning="True"
                  IsVisible="False"
                  HorizontalOptions="Center"
                  VerticalOptions="Center"
                  WidthRequest="50"
                  HeightRequest="50"/>

            <!-- ➤ Store No -->
            <Grid ColumnDefinitions="120,*"
                  Margin="0,0,0,10" 
                  VerticalOptions="Center">
                <Label x:Name="lblDeptStore" 
                       Text="Store No:" 
                       FontAttributes="Bold" 
                       FontSize="Medium"
                       Grid.Column="0" 
                       VerticalOptions="Center" 
                       HorizontalOptions="Start"/>
                <Entry x:Name="txtDeptStore" 
                       TextChanged="TxtDeptStore_TextChanged"
                       Grid.Column="1" 
                       VerticalOptions="Center" 
                       HorizontalOptions="Fill"
                       BackgroundColor="WhiteSmoke" 
                       HeightRequest="40" 
                       FontSize="Medium"/>
            </Grid>

            <!-- ➤ SKU to Pick -->
            <Grid ColumnDefinitions="120,*" 
                  Margin="0,0,0,10" 
                  VerticalOptions="Center">
                <Label x:Name="lblSkuToPick" 
                      Text="SKU to Pick:" 
                      FontAttributes="Bold" 
                      FontSize="Medium"
                      Grid.Column="0" 
                      VerticalOptions="Center" 
                      HorizontalOptions="Start"/>
                <Entry x:Name="txtpSKU" 
                      IsReadOnly="True" 
                      TextChanged="TxtpSKU_TextChanged"
                      Grid.Column="1" 
                      VerticalOptions="Center" 
                      HorizontalOptions="Fill"
                      BackgroundColor="WhiteSmoke" 
                      HeightRequest="40" 
                      FontSize="Medium"/>
            </Grid>

            <!-- ➤ Description Box -->
            <Entry x:Name="llblDescr" 
                  IsReadOnly="True"
                  BackgroundColor="WhiteSmoke" 
                  HeightRequest="40"
                  FontSize="Medium" 
                  Margin="0,0,0,10"/>
            <Entry x:Name="txtpDescr" 
                  Placeholder="Description" 
                  TextChanged="TxtpDescr_TextChanged"/>

            <!-- ➤ SKU List -->
            <CollectionView x:Name="lvSKU"
                    SelectionMode="Single"
                    SelectionChanged="LvSKU_SelectionChanged"
                    HeightRequest="200"
                    Margin="0,0,0,10">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Label Text="{Binding SKU}" FontSize="Medium" Padding="5"/>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
            </CollectionView>

            <!-- BARCODE PANEL -->
            <Frame x:Name="pnlBarcodes"
                    IsVisible="False"
                    BackgroundColor="White"
                    BorderColor="Gray"
                    CornerRadius="10"
                    Padding="10"
                    HasShadow="True"
                    HorizontalOptions="FillAndExpand"
                    VerticalOptions="Start">
                <VerticalStackLayout Spacing="5">
                    <!-- Header -->
                    <Label x:Name="lblBarcodeTitle"
                        Text="BARCODE"
                        HorizontalOptions="Center"
                        FontAttributes="Bold"
                        Loaded="LblBarcodeTitle_Loaded"/>
                    
                    <!-- Search / Input Entry (first focusable control) -->
                    <Entry x:Name="txtBarcodeSearch"
                        Placeholder="Scan or enter UPC"
                        HorizontalOptions="FillAndExpand"/>

                    <!-- CollectionView for UPCs -->
                    <CollectionView x:Name="lvBarcodes"
                        ItemsSource="{Binding barcodeList}"
                        SelectionMode="Single"
                        HeightRequest="200">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="5" ColumnDefinitions="*,*">
                                    <Label Text="{Binding Text}" Grid.Column="0"/>
                                    <Label Text="{Binding UPC}" Grid.Column="1" HorizontalTextAlignment="End"/>
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <!-- Close button -->
                    <Button x:Name="btnClose"
                        Text="Close"
                        WidthRequest="150"
                        BackgroundColor="Red"
                        TextColor="White"
                        Clicked="BtnClose_Clicked"
                        HorizontalOptions="Center"
                        Margin="0,10,0,0"/>

                </VerticalStackLayout>
            </Frame>

            <!-- ➤ From Slot Selection -->
            <Grid ColumnDefinitions="120,*" Margin="0,0,0,10" HeightRequest="38">

                <Label x:Name="lblFromSlot"
                    Text="From Slot:"
                    FontAttributes="Bold"
                    VerticalTextAlignment="Center"
                    Grid.Column="0"
                    VerticalOptions="Center"/>

                <!-- RIGHT SIDE GRID (Slot display + clickable overlay) -->
                <Grid Grid.Column="1">

                    <!-- BACKGROUND ENTRY (non-clickable display only) -->
                    <Entry x:Name="txtpSlot"
                        IsReadOnly="True"
                        BackgroundColor="#EEEEEE"
                        HeightRequest="38"
                        VerticalOptions="FillAndExpand"
                        HorizontalOptions="FillAndExpand"
                        TextChanged="TxtpSlot_TextChanged"/>

                    <!-- CLICKABLE LABEL IN FRONT -->
                    <Label x:Name="llblSlot"
                        Text="View Slot"
                        TextColor="Blue"
                        FontAttributes="Bold"
                        BackgroundColor="Transparent"
                        VerticalTextAlignment="Center"
                        HorizontalTextAlignment="Center"
                        HeightRequest="38"
                        VerticalOptions="FillAndExpand"
                        HorizontalOptions="FillAndExpand"
                        InputTransparent="False"
                        ZIndex="9999">
                            <Label.GestureRecognizers>
                                <TapGestureRecognizer Tapped="LlblSlot_Tapped"/>
                            </Label.GestureRecognizers>
                    </Label>
                </Grid>
            </Grid>

            <!-- Slot Panel -->
            <Frame x:Name="pnlSlots" 
                   IsVisible="False" 
                   BorderColor="Gray" 
                   Padding="10" 
                   Margin="0,10,0,10">
                <VerticalStackLayout Spacing="10">
                    <Label x:Name="lblMultipleSlots" 
                        Text="Multiple Slots" 
                        FontAttributes="Bold" 
                        FontSize="Medium" 
                        HorizontalOptions="Center" 
                        VerticalOptions="Center"
                        Loaded="LblMultipleSlots_Loaded"/>

                    <CollectionView x:Name="lvSlots" SelectionMode="Single" SelectionChanged="LvSlots_SelectionChanged">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Label Text="{Binding Slot}" FontSize="Medium" Padding="5"/>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>

                    <Button x:Name="btnCloseSlot" 
                        Text="Close" 
                        BackgroundColor="Orange" 
                        TextColor="White" 
                        Clicked="BtnCloseSlot_Clicked"/>
                </VerticalStackLayout>
            </Frame>

            <!-- ➤ Case & Each -->
            <Grid ColumnDefinitions="Auto,*,20,Auto,*" 
                  RowDefinitions="Auto" 
                  Margin="0,0,0,10">
                <Label x:Name="lblCase" 
                       Text="Case:" 
                       Grid.Column="0" 
                       VerticalOptions="Center"/>
                <Entry x:Name="txtpCase" 
                       Grid.Column="1" 
                       VerticalOptions="Center"
                       HeightRequest="40" 
                       HorizontalOptions="FillAndExpand"
                       TextChanged="TxtpCase_TextChanged"/>
                <Label Grid.Column="2"/>
                <Label x:Name="lblEach" 
                       Text="Each:" 
                       Grid.Column="3" 
                       VerticalOptions="Center"/>
                <Entry x:Name="txtpEach" Grid.Column="4" VerticalOptions="Center"
                       HeightRequest="40" HorizontalOptions="FillAndExpand"
                       TextChanged="TxtpEach_TextChanged"/>
            </Grid>

            <!-- Buttons Container -->
            <HorizontalStackLayout 
                x:Name="pnlNavigate" 
                Spacing="5" 
                Margin="0,0,0,10">
                    <Button x:Name="btnGoto" 
                        StyleId="btnGoto"
                        Text="Go To" 
                        Clicked="BtnNavigate_Clicked"/>
                    <Button x:Name="btnPrev" 
                        StyleId="btnPrev" 
                        Text="&lt; Prev" 
                        Clicked="BtnNavigate_Clicked"/>
                    <Button x:Name="btnNext" 
                        Text="Next &gt;" 
                        Clicked="BtnNext_Clicked"/>
            </HorizontalStackLayout>

            <!-- GO TO PANEL / pnlGoto -->
            <Frame x:Name="pnlGoto" 
                   IsVisible="False" 
                   BorderColor="Gray" 
                   Padding="20" 
                   Margin="0,5,0,10">
                <VerticalStackLayout Spacing="15">
                    <Label x:Name="Gotolbl" 
                           Text="GO TO" 
                           FontSize="20" 
                           HorizontalOptions="Center" 
                           FontAttributes="Bold"/>
                   <VerticalStackLayout Spacing="20">
                        <Button x:Name="btnFirst"
                                StyleId="btnFirst" 
                                Text="First" 
                                WidthRequest="150"
                                Clicked="BtnNavigate_Clicked"/>
                        <Button x:Name="btnLast" 
                                StyleId="btnLast" 
                                Text="Last" 
                                WidthRequest="150" 
                                Clicked="BtnNavigate_Clicked"/>
                        <Button x:Name="btnUnpick" 
                                StyleId="btnUnpick" 
                                Text="Unpicked" 
                                WidthRequest="150" 
                                Clicked="BtnNavigate_Clicked"/>
                   </VerticalStackLayout>
                        <Label x:Name="lblLineNo" 
                               Text="Line Number:" 
                               HorizontalOptions="Center" 
                               FontSize="14"/>
                        <Entry x:Name="txtLine" 
                               HorizontalOptions="Center" 
                               WidthRequest="150" 
                               FontSize="14"
                               Margin="0,-10,0,0" 
                               Completed="TxtLine_Completed"/>
                        <Button x:Name="btnCloseGoto" 
                                Text="Close" 
                                WidthRequest="150" 
                                BackgroundColor="Red"
                                TextColor="White" 
                                Clicked="BtnCloseGoto_Clicked"/>
                </VerticalStackLayout>
            </Frame>
            
            <!-- PANEL INPUT / pnlInput -->
            <Frame x:Name="pnlInput" 
                   Padding="10" 
                   Margin="0,10,0,10" 
                   BackgroundColor="WhiteSmoke">
                <VerticalStackLayout Spacing="10">
                    <!-- ➤ Barcode -->
                    <Grid ColumnDefinitions="120,*" 
                          Margin="0,0,0,10" 
                          VerticalOptions="Center">
                        <Label x:Name="lblBarcode"
                            Text="Barcode:"
                            FontAttributes="Bold"
                            FontSize="Medium"
                            Grid.Column="0"
                            VerticalOptions="Center"
                            HorizontalOptions="Start"/>
                        <Entry x:Name="txtBarcode"
                            Grid.Column="1"
                            VerticalOptions="Center"
                            HorizontalOptions="FillAndExpand"
                            BackgroundColor="WhiteSmoke"
                            HeightRequest="40"
                            FontSize="Medium"
                            Completed="Entry_BarcodeAndQty_Completed"
                            TextChanged="TxtBarcode_TextChanged"
                            StyleId="txtBarcode"
                            Focused="Entry_GotFocus"
                            Unfocused="Entry_LostFocus"/>
                    </Grid>

                    <!-- ➤ Image Check -->
                    <ImageButton x:Name="pbScanned"
                            Source="scanned_icon.png"
                            WidthRequest="50"
                            HeightRequest="50"
                            HorizontalOptions="Start"
                            Clicked="PbScanned_Clicked"/>

                    <!-- ➤ SKU -->
                    <Grid ColumnDefinitions="120,*" Margin="0,0,0,10" VerticalOptions="Center">
                        <Label x:Name="lblSKU"
                            Text="SKU:"
                            FontAttributes="Bold"
                            FontSize="Medium"
                            Grid.Column="0"
                            VerticalOptions="Center"
                            HorizontalOptions="Start"/>
                        <Entry x:Name="txtSKU"
                            Grid.Column="1"
                            VerticalOptions="Center"
                            HorizontalOptions="FillAndExpand"
                            BackgroundColor="WhiteSmoke"
                            HeightRequest="40"
                            FontSize="Medium"
                            TextChanged="TxtSKU_TextChanged"/>
                    </Grid>

                    <!-- ➤ Case2 & Each2 -->
                    <Grid ColumnDefinitions="Auto,*,20,Auto,*" 
                          Margin="0,0,0,10" 
                          VerticalOptions="Center">
                        <Label x:Name="lblCase2" 
                               Text="Case 2:" 
                               Grid.Column="0" 
                               VerticalOptions="Center"/>
                        <Entry x:Name="txtCase" 
                               Grid.Column="1" 
                               VerticalOptions="Center" 
                               HeightRequest="40" 
                               HorizontalOptions="FillAndExpand"
                               TextChanged="TxtCase_TextChanged" 
                               Completed="Entry_BarcodeAndQty_Completed" 
                               Keyboard="Numeric" 
                               StyleId="txtCase" 
                               Focused="Entry_GotFocus" 
                               Unfocused="Entry_LostFocus"/>
                        <Label Grid.Column="2"/>
                        <Label x:Name="lblEach2" 
                               Text="Each 2:" 
                               Grid.Column="3" 
                               VerticalOptions="Center"/>
                        <Entry x:Name="txtEach" 
                               Grid.Column="4" 
                               VerticalOptions="Center" 
                               HeightRequest="40" 
                               HorizontalOptions="FillAndExpand"
                               TextChanged="TxtEach_TextChanged" 
                               Completed="Entry_BarcodeAndQty_Completed" 
                               Keyboard="Numeric" 
                               StyleId="txtEach" 
                               Focused="Entry_GotFocus" 
                               Unfocused="Entry_LostFocus"/>
                    </Grid>

                    <!-- Accept Button -->
                    <Button x:Name="btnAccept"
                            Text="Accept"
                            BackgroundColor="Green"
                            TextColor="White"
                            HeightRequest="40"
                            HorizontalOptions="FillAndExpand"
                            Clicked="BtnAccept_Clicked"/>

                    <!-- ➤ Done -->
                    <Grid ColumnDefinitions="120,*" 
                        Margin="0,0,0,10" 
                        VerticalOptions="Center">
                            <Label x:Name="lblDone"
                                Text="Done:"
                                FontAttributes="Bold"
                                FontSize="Medium"
                                Grid.Column="0"
                                VerticalOptions="Center"
                                HorizontalOptions="Start"/>
                            <Entry x:Name="txtDone"
                                Grid.Column="1"
                                VerticalOptions="Center"
                                HorizontalOptions="FillAndExpand"
                                BackgroundColor="WhiteSmoke"
                                HeightRequest="40"
                                FontSize="Medium"
                                TextColor="Green"
                                IsReadOnly="True"
                                Text="0/0"
                                TextChanged="TxtDone_TextChanged"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <!-- Confirm Panel -->
            <Frame x:Name="pnlConfirm" 
                   IsVisible="False" 
                   Padding="10" 
                   BackgroundColor="LightGray" 
                   Margin="0,10,0,10">
                <VerticalStackLayout Spacing="10">
                    <Label x:Name="lblConfirmTitle"
                        Text="Confirm Zero Qty from a Stocker"
                        FontAttributes="Bold"
                        FontSize="Medium"
                        HorizontalOptions="Center"
                        Loaded="LblConfirmTitle_Loaded"/>
                    <Label x:Name="lblInput"
                        Text="Stocker ID:"
                        FontSize="Small" 
                        TextColor="Gray"/>
                    <Entry x:Name="txtStocker"
                        Placeholder="Stocker"
                        Keyboard="Numeric"
                        Completed="TxtStocker_Completed"
                        TextChanged="TxtStocker_TextChanged"
                        StyleId="txtStocker"
                        Focused="Entry_GotFocus"
                        Unfocused="Entry_LostFocus"/>
                    <Button x:Name="btnConfirm"
                        Text="Confirm"
                        Clicked="BtnConfirm_Clicked" />
                    <Button x:Name="btnCancel"
                        Text="Cancel"
                        BackgroundColor="Red"
                        TextColor="White"
                        Clicked="BtnCancel_Clicked"/>
                </VerticalStackLayout>
            </Frame>
            
            <!-- Finish Button -->
            <Button x:Name="btnFinished"
                    Text="Finish Picking" 
                    IsVisible="False"/>

            <Label x:Name="lblUser"
                    Text="Please set USER ID!"
                    FontAttributes="Bold"
                    FontSize="Medium"
                    HorizontalOptions="Start"
                    VerticalOptions="Center"
                    Loaded="LblUser_Loaded"/>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
