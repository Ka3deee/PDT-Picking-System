<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="PDTPickingSystem.Views.CheckingPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Shell.NavBarIsVisible="False">

    <!-- ROOT LAYER -->
    <Grid>
        <VerticalStackLayout Padding="5" Spacing="5">

            <!-- Store / Department - AT THE TOP -->
            <Grid ColumnDefinitions="120,*"
                  Margin="10,5,5,10"
                  VerticalOptions="Center">
                <Label x:Name="lblDeptStore"
                       Text="Store No:"
                       FontAttributes="Bold"
                       FontSize="16"
                       Grid.Column="0"
                       VerticalOptions="Center"
                       Loaded="LblDeptStore_Loaded"/>
                <Entry x:Name="txtDeptStore"
                       Grid.Column="1"
                       HeightRequest="40"
                       BackgroundColor="WhiteSmoke"
                       IsReadOnly="True"
                       HorizontalTextAlignment="Center"
                       TextChanged="TxtDeptStore_TextChanged"/>
            </Grid>

            <!-- Main Input Frame -->
            <Frame Padding="10"
                    Margin="5,-15,5,0"
                    HasShadow="True"
                    BorderColor="LightGray">
                <VerticalStackLayout x:Name="pnlInput"
                                     Spacing="5">

                    <!-- Barcode -->
                    <Label x:Name="lblBarcode"
                           Text="Barcode:"
                           FontAttributes="Bold"
                           FontSize="16"
                           Loaded="LblBarcode_Loaded"/>
                    <Entry x:Name="txtBarcode"
                           Placeholder="Barcode"
                           FontSize="16"
                           Completed="Entry_Completed"
                           HorizontalTextAlignment="Center"
                           TextChanged="Entry_TextChanged"/>

                    <!-- Description -->
                    <Entry x:Name="txtDesc"
                           Placeholder="Description"
                           FontSize="16"
                           IsReadOnly="True"
                           HorizontalTextAlignment="Center"
                           TextChanged="TxtDesc_TextChanged"/>

                    <!-- Scanner + SKU -->
                    <Grid ColumnDefinitions="50,10,Auto,*"
                          Margin="0,0,0,10">
                        <ImageButton x:Name="pbScanned"
                                     Grid.Column="0"
                                     Source="scanned_icon2.png"
                                     HeightRequest="40"
                                     WidthRequest="40"
                                     BackgroundColor="White"
                                     IsVisible="True"/>
                        <Label x:Name="lblSKU"
                               Grid.Column="2"
                               Text="SKU:"
                               FontAttributes="Bold"
                               FontSize="16"
                               VerticalOptions="Center"
                               Loaded="LblSKU_Loaded"/>
                        <Entry x:Name="txtSKU"
                               Grid.Column="3"
                               Placeholder=""
                               IsReadOnly="True"
                               HorizontalTextAlignment="Center"
                               TextChanged="TxtSKU_TextChanged"/>
                    </Grid>

                    <!-- Case / Each -->
                    <Grid ColumnDefinitions="Auto,*,20,Auto,*"
                          Margin="0,-5,0,10">
                        <Label x:Name="lblCase"
                               Text="Case:"
                               FontAttributes="Bold"
                               FontSize="16"
                               Grid.Column="0" 
                               VerticalOptions="Center" 
                               Loaded="LblCase_Loaded"/>
                        <Entry x:Name="txtCase" 
                               Grid.Column="1" 
                               HeightRequest="40"
                               FontAttributes="Bold"
                               FontSize="16"
                               Completed="Entry_Completed" 
                               HorizontalTextAlignment="Center"
                               TextChanged="Entry_TextChanged"/>
                        <BoxView Grid.Column="2" 
                                 WidthRequest="20"/>
                        <Label x:Name="lblEach" 
                               Text="Each:"
                               FontAttributes="Bold"
                               FontSize="16"
                               Grid.Column="3" 
                               VerticalOptions="Center" 
                               Loaded="LblEach_Loaded"/>
                        <Entry x:Name="txtEach"
                               FontAttributes="Bold"
                               FontSize="16"
                               Grid.Column="4"
                               HeightRequest="40" 
                               Completed="Entry_Completed" 
                               HorizontalTextAlignment="Center"
                               TextChanged="Entry_TextChanged"/>
                    </Grid>

                    <!-- BUM / Done -->
                    <Grid ColumnDefinitions="Auto,*,20,Auto,*" 
                          Margin="0,-5,0,10">
                        <Label x:Name="lblBUM" 
                               Text="BUM:"
                               FontAttributes="Bold"
                               FontSize="16"
                               Grid.Column="0" 
                               VerticalOptions="Center" 
                               Loaded="LblBUM_Loaded"/>
                        <Entry x:Name="txtBum"
                               FontAttributes="Bold"
                               FontSize="16"
                               Grid.Column="1" 
                               HeightRequest="40" 
                               IsReadOnly="True"
                               HorizontalTextAlignment="Center"
                               TextChanged="TxtBum_TextChanged"/>
                        <BoxView Grid.Column="2" 
                                 WidthRequest="20"/>
                        <Label x:Name="lblDone" 
                               Text="Done:"
                               FontAttributes="Bold"
                               FontSize="16"
                               Grid.Column="3" 
                               VerticalOptions="Center" 
                               Loaded="LblDone_Loaded"/>
                        <Entry x:Name="txtDone"
                               FontAttributes="Bold"
                               FontSize="16"
                               Grid.Column="4" 
                               HeightRequest="40" 
                               IsReadOnly="True"
                               HorizontalTextAlignment="Center"
                               TextChanged="TxtDone_TextChanged"/>
                    </Grid>

                    <!-- Buttons Row -->
                    <Grid ColumnDefinitions="*,*" 
                              ColumnSpacing="10" 
                              Margin="0,0,0,0">

                        <Button x:Name="btnViewItems" 
                                Grid.Column="0" 
                                Text="View Items" 
                                FontAttributes="Bold" 
                                FontSize="16" 
                                HeightRequest="40" 
                                BackgroundColor="Blue"
                                Clicked="BtnViewItems_Clicked"/>

                        <Button x:Name="btnAccept" 
                                Grid.Column="1" 
                                Text="Accept" 
                                FontAttributes="Bold" 
                                FontSize="16" 
                                HeightRequest="40" 
                                BackgroundColor="Blue"
                                Clicked="BtnAccept_Clicked"/>

                        <!-- HIDDEN - Kept for future use, overlaps btnAccept -->
                        <Button x:Name="btnConso" 
                                Grid.Column="1" 
                                Text="Conso" 
                                FontAttributes="Bold" 
                                FontSize="Medium" 
                                HeightRequest="50" 
                                Clicked="BtnConso_Clicked"
                                IsVisible="False"
                                IsEnabled="False"/>
                    </Grid>
                </VerticalStackLayout>
            </Frame>

            <Frame Padding="8"
                    Margin="5,0,5,0"
                    HasShadow="True"
                    BorderColor="LightGray">
                <VerticalStackLayout>
                    <!-- Transfer, Location, Picker, Transfer # Labels -->
                    <Label x:Name="lblTransfer" 
                           Text="Transfer:" 
                           Loaded="LblTransfer_Loaded"/>
                    <Label x:Name="lblLoc"
                           Text="Location:" 
                           Loaded="LblLoc_Loaded"/>
                    <Label x:Name="lblPicker" 
                           Text="Picker:" 
                           Loaded="LblPicker_Loaded"/>
                </VerticalStackLayout>
            </Frame>

            <Label x:Name="lblTrf" 
                Margin="10,-2,0,0"
                Text="Transfer #:" 
                FontAttributes="Italic"
                FontSize="14"
                Loaded="LblTrf_Loaded"/>

            <!-- Items panel (OUTSIDE pnlInput) -->
            <Grid x:Name="pnlItems"
      IsVisible="False"
      Margin="0,10,0,0"
      VerticalOptions="FillAndExpand"
                      HorizontalOptions="FillAndExpand"
      RowDefinitions="Auto,*,Auto,Auto">

                <!-- COLUMN HEADERS -->
                <Grid Grid.Row="0"
          ColumnDefinitions="20,30,*,20,50,40,*,30"
          Padding="5"
          BackgroundColor="Blue">
                    <Label Text="ID" Grid.Column="0" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="SKU" Grid.Column="1" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="Descr" Grid.Column="2" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="Qty" Grid.Column="3" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="Picked" Grid.Column="4" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="chkQty" Grid.Column="5" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="BUM" Grid.Column="6" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="Slot" Grid.Column="7" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                </Grid>

                <!-- COLLECTION VIEW -->
                <CollectionView Grid.Row="1"
                    x:Name="lvSKU"
                    SelectionMode="Single"
                    VerticalOptions="FillAndExpand">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="20,30,*,20,50,40,*,30"
                      Padding="5"
                      Margin="0,5,0,5"
                      BackgroundColor="White">
                                <Label Text="{Binding ID}" Grid.Column="0" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding SKU}" Grid.Column="1" FontSize="12"/>
                                <Label Text="{Binding Descr}" Grid.Column="2" FontSize="12" LineBreakMode="TailTruncation"/>
                                <Label Text="{Binding Qty}" Grid.Column="3" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding PickQty}" Grid.Column="4" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding ChkQty}" Grid.Column="5" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding BUM}" Grid.Column="6" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding Slot}" Grid.Column="7" FontSize="12" HorizontalTextAlignment="Center"/>

                                <!-- Separator line -->
                                <BoxView Grid.ColumnSpan="8"
                             HeightRequest="1"
                             Color="LightGray"
                             VerticalOptions="End"/>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- COUNT LABEL -->
                <Label Grid.Row="2"
           x:Name="lblCnt"
           Text="Count: 0"
           FontAttributes="Bold"
           FontSize="14"
           Margin="5,10,0,10"
           HorizontalOptions="Start"/>

                <!-- CLOSE BUTTON -->
                <Button Grid.Row="3"
            x:Name="btnCloseItems"
            Text="Close"
            FontAttributes="Bold"
            BackgroundColor="Red"
            TextColor="White"
            HeightRequest="40"
            WidthRequest="150"
            HorizontalOptions="Center"
            Margin="0,0,5,5"
            Clicked="BtnCloseItems_Clicked"/>
            </Grid>


            <!-- Second Items Panel (OUTSIDE pnlInput) -->
            <Grid x:Name="pnlItems2"
IsVisible="False"
Margin="0,10,0,0"
VerticalOptions="FillAndExpand"
                HorizontalOptions="FillAndExpand"
RowDefinitions="Auto,*,Auto,Auto">

                <!-- COLUMN HEADERS -->
                <Grid Grid.Row="0"
    ColumnDefinitions="20,30,*,20,50,40,*,30"
    Padding="5"
    BackgroundColor="Blue">
                    <Label Text="ID" Grid.Column="0" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="SKU" Grid.Column="1" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="Descr" Grid.Column="2" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="Qty" Grid.Column="3" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="Picked" Grid.Column="4" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="chkQty" Grid.Column="5" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="BUM" Grid.Column="6" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                    <Label Text="Slot" Grid.Column="7" FontSize="12" FontAttributes="Bold" TextColor="White" HorizontalTextAlignment="Center"/>
                </Grid>

                <!-- COLLECTION VIEW -->
                <CollectionView Grid.Row="1"
              x:Name="lvSKU2"
              SelectionMode="Single"
              VerticalOptions="FillAndExpand">
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <Grid ColumnDefinitions="20,30,*,20,50,40,*,30"
                Padding="5"
                Margin="0,5,0,5"
                BackgroundColor="White">
                                <Label Text="{Binding ID}" Grid.Column="0" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding SKU}" Grid.Column="1" FontSize="12"/>
                                <Label Text="{Binding Descr}" Grid.Column="2" FontSize="12" LineBreakMode="TailTruncation"/>
                                <Label Text="{Binding Qty}" Grid.Column="3" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding PickQty}" Grid.Column="4" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding ChkQty}" Grid.Column="5" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding BUM}" Grid.Column="6" FontSize="12" HorizontalTextAlignment="Center"/>
                                <Label Text="{Binding Slot}" Grid.Column="7" FontSize="12" HorizontalTextAlignment="Center"/>

                                <!-- Separator line -->
                                <BoxView Grid.ColumnSpan="8"
                       HeightRequest="1"
                       Color="LightGray"
                       VerticalOptions="End"/>
                            </Grid>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- COUNT LABEL -->
                <Label Grid.Row="2"
     x:Name="lblCnt2"
     Text="Count: 0"
     FontAttributes="Bold"
     FontSize="14"
     Margin="5,10,0,10"
     HorizontalOptions="Start"/>

                <!-- CLOSE BUTTON -->
                <Button Grid.Row="3"
      x:Name="btnCloseItems2"
      Text="Close"
      FontAttributes="Bold"
      BackgroundColor="Red"
      TextColor="White"
      HeightRequest="40"
      WidthRequest="150"
      HorizontalOptions="Center"
      Margin="0,0,5,5"
      Clicked="BtnCloseItems2_Clicked"/>
            </Grid>

            <!-- Request Button (OUTSIDE pnlInput) -->
            <ImageButton x:Name="pbReq"
                         Source="your_image.png"
                         HeightRequest="50"
                         WidthRequest="50"
                         BackgroundColor="Black"
                         IsVisible="False"/>

            <!-- Confirmation Panel (OUTSIDE pnlInput) -->
            <Frame x:Name="pnlConfirm" 
    IsVisible="False" 
    Padding="20" 
    BackgroundColor="White" 
    BorderColor="Gray"
    CornerRadius="10"
    HasShadow="True"
    Margin="20"
    VerticalOptions="Center"
    HorizontalOptions="Center"
    WidthRequest="280"
    HeightRequest="350"
    InputTransparent="False"
    ZIndex="100">
                <VerticalStackLayout Spacing="10">
                    <Label x:Name="lblConfirmTitle"
            Text="Confirm Zero Qty from a Stocker"
            FontAttributes="Bold"
            FontSize="25"
            TextColor="Black"
            HorizontalOptions="Center"
            HorizontalTextAlignment="Center"
            Loaded="LblConfirmTitle_Loaded"/>
                    <Label x:Name="lblInput"
            Text="Stocker ID:"
            FontAttributes="Bold"
            FontSize="16" 
            TextColor="Black"
            HorizontalOptions="Center"
            Margin="0,10,0,0"
            Loaded="LblInput_Loaded"/>
                    <Entry x:Name="txtStocker"
            Placeholder="Enter Stocker ID"
            Keyboard="Numeric"
            WidthRequest="150"
            HeightRequest="50"
            Completed="TxtStocker_Completed"
            TextChanged="TxtStocker_TextChanged"
            StyleId="txtStocker"
            HorizontalTextAlignment="Center"
            Margin="0,5,0,10"/>
                    <Button x:Name="btnConfirm"
            Text="Confirm"
            FontSize="Medium"
            FontAttributes="Bold"
            BackgroundColor="Blue"
            WidthRequest="150"
            HeightRequest="50"
            Clicked="BtnConfirm_Clicked" />
                    <Button x:Name="btnCancel"
            Text="Cancel"
            FontSize="Medium"
            FontAttributes="Bold"
            BackgroundColor="Red"
            TextColor="White"
            WidthRequest="150"
            HeightRequest="50"
            Clicked="BtnCancel_Clicked"/>
                </VerticalStackLayout>
            </Frame>

            <!-- Navigation Panel (OUTSIDE pnlInput) -->
            <StackLayout x:Name="pnlNavigate" 
                         IsVisible="False" 
                         Orientation="Horizontal" 
                         HorizontalOptions="Center"
                         Margin="0,10,0,0" 
                         Spacing="10">
            </StackLayout>

            <!-- Hidden Labels for data storage (OUTSIDE pnlInput) -->
            <Label x:Name="txtpCase" IsVisible="False"/>
            <Label x:Name="txtpDescr" IsVisible="False"/>
            <Label x:Name="txtpEach" IsVisible="False"/>
            <Label x:Name="txtpSKU" IsVisible="False"/>
            <Label x:Name="txtpSlot" IsVisible="False"/>

        </VerticalStackLayout>

        <!-- FLOATING FINISHED BUTTON - Above txtBarcode -->
            <Button x:Name="btnFinished"
                Text="✓ Finished"
                IsVisible="False"
                BackgroundColor="#28a745"
                TextColor="White"
                FontAttributes="Bold"
                FontSize="18"
                HeightRequest="55"
                WidthRequest="200"
                CornerRadius="27"
                Clicked="BtnFinished_Clicked"
                VerticalOptions="Start"
                HorizontalOptions="Center"
                Margin="0,110,0,0"
                ZIndex="1000"
                Opacity="0.95"/>
    </Grid>
</ContentPage>